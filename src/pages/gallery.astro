---
import BaseLayout from '../layouts/BaseLayout.astro';
import { paintings } from '../data/paintings';

// Split paintings into square-ish (first 15) and irregular (last 4)
const squareish = paintings.slice(0, 15);
const irregular = paintings.slice(15);
---

<BaseLayout title="Portfolio" description="Browse abstract paintings by Kay Breaux Livaudais">
  <section class="px-6 md:px-12 lg:px-20 py-12 md:py-16">
    <div class="max-w-7xl mx-auto">
      <h1 class="font-heading text-[21px] text-warm-700 mb-4 uppercase tracking-wide-3 font-normal text-center">Portfolio</h1>
      <p class="text-warm-400 text-[15px] leading-[28px] mb-12 max-w-2xl mx-auto text-center">
        A collection of abstract paintings exploring color, texture, and emotion.
      </p>

      <!-- Square grid section -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6">
        {squareish.map((painting, i) => (
          <div
            class="group cursor-pointer"
            data-index={i}
            onclick="openLightbox(this)"
          >
            <div class="aspect-square bg-warm-100 overflow-hidden relative">
              {painting.image ? (
                <img
                  src={painting.thumb || painting.image}
                  alt={painting.title}
                  class="w-full h-full object-cover group-hover:scale-105 transition-transform duration-500"
                  loading="lazy"
                />
              ) : (
                <div class="w-full h-full flex items-center justify-center">
                  <p class="text-warm-400 font-body italic text-sm">{painting.title}</p>
                </div>
              )}
              <div class="absolute inset-0 bg-warm-900/0 group-hover:bg-warm-900/10 transition-colors duration-300" />
            </div>
            <div class="mt-2">
              <p class="font-heading text-sm text-warm-700 uppercase tracking-wide-1">{painting.title}</p>
              <p class="text-warm-400 text-xs mt-0.5">{painting.dimensions} · {painting.medium}</p>
            </div>
          </div>
        ))}
      </div>

      <!-- Irregular shapes - full uncropped, centered in square cells -->
      <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6 mt-4 md:mt-6">
        {irregular.map((painting, i) => (
          <div
            class="group cursor-pointer"
            data-index={squareish.length + i}
            onclick="openLightbox(this)"
          >
            <div class="aspect-square bg-warm-100 overflow-hidden relative flex items-center justify-center">
              {painting.image ? (
                <img
                  src={painting.thumb || painting.image}
                  alt={painting.title}
                  class="max-w-full max-h-full object-contain group-hover:scale-105 transition-transform duration-500"
                  loading="lazy"
                />
              ) : (
                <div class="w-full h-full flex items-center justify-center">
                  <p class="text-warm-400 font-body italic text-sm">{painting.title}</p>
                </div>
              )}
              <div class="absolute inset-0 bg-warm-900/0 group-hover:bg-warm-900/10 transition-colors duration-300" />
            </div>
            <div class="mt-2">
              <p class="font-heading text-sm text-warm-700 uppercase tracking-wide-1">{painting.title}</p>
              <p class="text-warm-400 text-xs mt-0.5">{painting.dimensions} · {painting.medium}</p>
            </div>
          </div>
        ))}
      </div>
    </div>
  </section>

  <!-- Lightbox Modal -->
  <div id="lightbox" class="fixed inset-0 bg-warm-900/90 z-50 hidden items-center justify-center" onclick="closeLightbox(event)">
    <!-- Close button -->
    <button
      class="absolute top-6 right-6 text-white/80 hover:text-white text-3xl font-light z-10"
      onclick="closeLightbox(event, true)"
      aria-label="Close"
    >
      ✕
    </button>

    <!-- Previous arrow -->
    <button
      id="lb-prev"
      class="absolute left-4 md:left-8 top-1/2 -translate-y-1/2 text-white/60 hover:text-white text-5xl font-light z-10 select-none"
      onclick="event.stopPropagation(); navigateLightbox(-1)"
      aria-label="Previous"
    >
      ‹
    </button>

    <!-- Next arrow -->
    <button
      id="lb-next"
      class="absolute right-4 md:right-8 top-1/2 -translate-y-1/2 text-white/60 hover:text-white text-5xl font-light z-10 select-none"
      onclick="event.stopPropagation(); navigateLightbox(1)"
      aria-label="Next"
    >
      ›
    </button>

    <!-- Image + info -->
    <div class="flex flex-col items-center max-w-5xl w-full px-16 md:px-24" onclick="event.stopPropagation()">
      <div id="lightbox-image" class="w-full flex items-center justify-center">
        <p class="text-warm-400 font-body italic">Image placeholder</p>
      </div>
      <div id="lightbox-info" class="mt-4 text-center">
        <p id="lb-title" class="font-heading text-sm text-white/90 uppercase tracking-wide-1"></p>
        <p id="lb-details" class="text-white/50 text-xs mt-1"></p>
      </div>
    </div>
  </div>

  <!-- Paintings data for JS -->
  <script is:inline define:vars={{ allPaintings: paintings }}>
    let currentIndex = 0;

    function openLightbox(el) {
      currentIndex = parseInt(el.dataset.index, 10);
      showPainting(currentIndex);
      const lightbox = document.getElementById('lightbox');
      lightbox.classList.remove('hidden');
      lightbox.classList.add('flex');
      document.body.style.overflow = 'hidden';
    }

    function showPainting(idx) {
      const painting = allPaintings[idx];
      const imageContainer = document.getElementById('lightbox-image');

      if (painting.image) {
        imageContainer.innerHTML = `<img src="${painting.image}" alt="${painting.title}" class="max-w-full max-h-[80vh] object-contain" />`;
      } else {
        imageContainer.innerHTML = `<p class="text-warm-400 font-body italic">${painting.title}</p>`;
      }

      document.getElementById('lb-title').textContent = painting.title;
      document.getElementById('lb-details').textContent = `${painting.dimensions} · ${painting.medium}`;
    }

    function navigateLightbox(dir) {
      currentIndex = (currentIndex + dir + allPaintings.length) % allPaintings.length;
      showPainting(currentIndex);
    }

    function closeLightbox(event, force) {
      if (force || event.target === document.getElementById('lightbox')) {
        const lightbox = document.getElementById('lightbox');
        lightbox.classList.add('hidden');
        lightbox.classList.remove('flex');
        document.body.style.overflow = '';
      }
    }

    document.addEventListener('keydown', (e) => {
      const lightbox = document.getElementById('lightbox');
      if (lightbox.classList.contains('hidden')) return;

      if (e.key === 'Escape') closeLightbox(e, true);
      if (e.key === 'ArrowLeft') navigateLightbox(-1);
      if (e.key === 'ArrowRight') navigateLightbox(1);
    });
  </script>
</BaseLayout>
